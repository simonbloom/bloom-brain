# /save-this-plan - Save Last Generated Plan

## Purpose
Quickly save the most recently generated plan without needing to specify a name or details. This command automatically detects the last plan generated and saves it to the Claude analysis directory.

## Usage

### Basic Usage
```bash
/save-this-plan                 # Save last plan with auto-generated name
/save-this-plan [custom-name]   # Save last plan with custom name
```

### Advanced Options
```bash
/save-this-plan --force         # Overwrite existing plan with same name
/save-this-plan --preview       # Preview what would be saved
/save-this-plan --metadata      # Include additional metadata
/save-this-plan --archive       # Save and immediately archive
```

## Auto-Detection Logic

### Plan Detection
The command automatically detects the last generated plan by analyzing:
- Most recent command output
- Content patterns (implementation steps, analysis sections)
- Command history context
- Generated analysis structure

### Supported Plan Types
```
ğŸ” DETECTABLE PLAN TYPES

âœ… Feature Plans:
â”œâ”€â”€ Generated by: /new-feature [description]
â”œâ”€â”€ Detection pattern: "Implementation Roadmap", "Phase 1", "Phase 2"
â”œâ”€â”€ Auto-name format: feature-[description]-[date]
â””â”€â”€ Save location: .claude/analysis/feature-[name]/

âœ… Ultra-Debug Plans:
â”œâ”€â”€ Generated by: /ultra-debug [target]
â”œâ”€â”€ Detection pattern: "Ultra-Debug", "Root Cause Analysis", "Multi-MCP"
â”œâ”€â”€ Auto-name format: ultra-debug-[target]-[session-id]
â””â”€â”€ Save location: .claude/analysis/ultra-debug-[name]/

âœ… Debug Plans:
â”œâ”€â”€ Generated by: /understand [target]
â”œâ”€â”€ Detection pattern: "Debug Analysis", "Solution Strategy"
â”œâ”€â”€ Auto-name format: debug-[target]-[session-id]
â””â”€â”€ Save location: .claude/analysis/debug-[name]/

âœ… Architecture Plans:
â”œâ”€â”€ Generated by: /architecture-map [area]
â”œâ”€â”€ Detection pattern: "Architecture Analysis", "System Map"
â”œâ”€â”€ Auto-name format: architecture-[area]-[date]
â””â”€â”€ Save location: .claude/analysis/architecture-[name]/

âœ… Impact Analysis:
â”œâ”€â”€ Generated by: /impact-check [change]
â”œâ”€â”€ Detection pattern: "Impact Assessment", "Risk Analysis"
â”œâ”€â”€ Auto-name format: impact-[change]-[date]
â””â”€â”€ Save location: .claude/analysis/impact-[name]/
```

## Execution Examples

### Save Feature Plan
```bash
# After running: /new-feature user notification system
/save-this-plan

# Output:
âœ… PLAN SAVED: feature-user-notification-system-20250715

ğŸ“ Location: .claude/analysis/feature-user-notification-system-20250715/
ğŸ“‹ Files Created:
â”œâ”€â”€ implementation-plan.md
â”œâ”€â”€ research-findings.json
â”œâ”€â”€ database-analysis.json
â”œâ”€â”€ architecture-analysis.json
â”œâ”€â”€ risk-assessment.json
â””â”€â”€ execution-checklist.md

ğŸš€ Next Steps: /run-plan user-notification-system-20250715
```

### Save Ultra-Debug Analysis
```bash
# After running: /ultra-debug spinner loading issue
/save-this-plan spinner-fix

# Output:
âœ… PLAN SAVED: ultra-debug-spinner-fix

ğŸ“ Location: .claude/analysis/ultra-debug-spinner-fix/
ğŸ“‹ Files Created:
â”œâ”€â”€ ultra-solutions-implementation-plan.md
â”œâ”€â”€ root-cause-summary.md
â”œâ”€â”€ mcp-tools-analysis.json
â””â”€â”€ testing-strategy.md

ğŸš€ Next Steps: /run-plan spinner-fix
```

### Save with Custom Name
```bash
# After running: /new-feature dashboard analytics
/save-this-plan analytics-dashboard-v2

# Output:
âœ… PLAN SAVED: analytics-dashboard-v2

ğŸ“ Location: .claude/analysis/feature-analytics-dashboard-v2/
ğŸ“‹ Files Created:
â”œâ”€â”€ implementation-plan.md
â”œâ”€â”€ research-findings.json
â”œâ”€â”€ database-analysis.json
â””â”€â”€ execution-checklist.md

ğŸš€ Next Steps: /run-plan analytics-dashboard-v2
```

## Content Analysis

### Plan Content Detection
```javascript
function detectPlanContent(lastOutput) {
  const patterns = {
    feature: {
      indicators: [
        'Implementation Roadmap',
        'Phase 1: Research',
        'Phase 2: Planning',
        'Feature Analysis',
        'Database Schema',
        'Component Architecture'
      ],
      confidence: 0.85
    },
    ultraDebug: {
      indicators: [
        'Ultra-Debug Phase',
        'Root Cause Analysis',
        'Multi-MCP Analysis',
        'Implementation Roadmap',
        'Ultra-Solutions',
        'MCP Tools Used'
      ],
      confidence: 0.90
    },
    debug: {
      indicators: [
        'Debug Analysis',
        'Solution Strategy',
        'Browser Agent',
        'Performance Agent',
        'Implementation Steps'
      ],
      confidence: 0.80
    }
  };
  
  return analyzePlanType(lastOutput, patterns);
}
```

### Auto-Name Generation
```javascript
function generatePlanName(type, content, customName) {
  if (customName) return customName;
  
  const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');
  const description = extractDescription(content);
  
  return `${type}-${description}-${timestamp}`;
}

function extractDescription(content) {
  // Extract meaningful description from plan content
  const titleMatch = content.match(/(?:Feature|Analysis|Debug).*?:\s*(.+)/i);
  if (titleMatch) {
    return titleMatch[1]
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, '')
      .replace(/\s+/g, '-')
      .slice(0, 30);
  }
  return 'unnamed-plan';
}
```

## Preview Mode

### Preview Before Saving
```bash
/save-this-plan --preview
```

```
ğŸ” PLAN PREVIEW: Last Generated Plan

ğŸ“‹ Detected Plan:
â”œâ”€â”€ Type: Feature Plan
â”œâ”€â”€ Confidence: 92%
â”œâ”€â”€ Generated: 5 minutes ago
â”œâ”€â”€ Content size: 2,847 words
â””â”€â”€ Estimated save time: 3 seconds

ğŸ“ Save Details:
â”œâ”€â”€ Auto-name: feature-user-dashboard-20250715
â”œâ”€â”€ Location: .claude/analysis/feature-user-dashboard-20250715/
â”œâ”€â”€ Files to create: 6
â””â”€â”€ Storage required: 124 KB

ğŸ“Š Plan Structure:
â”œâ”€â”€ âœ… Executive Summary (247 words)
â”œâ”€â”€ âœ… Implementation Roadmap (8 steps)
â”œâ”€â”€ âœ… Database Analysis (5 tables)
â”œâ”€â”€ âœ… Architecture Overview (12 components)
â”œâ”€â”€ âœ… Risk Assessment (3 high, 5 medium risks)
â””â”€â”€ âœ… Testing Strategy (unit, integration, e2e)

ğŸš€ Save this plan? [Y/n]
```

## Error Handling

### No Plan Found
```
âŒ NO PLAN DETECTED

ğŸ“‹ Analysis Results:
â”œâ”€â”€ Last command: /list-plans
â”œâ”€â”€ Output type: Management command
â”œâ”€â”€ Plan content: None detected
â””â”€â”€ Confidence: 0%

ğŸ’¡ Suggestions:
â”œâ”€â”€ Generate a new plan: /new-feature [description]
â”œâ”€â”€ Run debug analysis: /ultra-debug [target]
â”œâ”€â”€ Check existing plans: /list-plans
â””â”€â”€ View plan status: /plan-status [name]

ğŸ” Recent Commands:
â”œâ”€â”€ /list-plans (2 minutes ago)
â”œâ”€â”€ /run-plan user-auth (15 minutes ago)
â”œâ”€â”€ /new-feature notifications (1 hour ago)
â””â”€â”€ /save-this-plan (attempted)

ğŸ’¡ Try: /save-plan notifications (to save the notifications plan)
```

### Multiple Plans Detected
```
âš ï¸ MULTIPLE PLANS DETECTED

ğŸ“‹ Found 2 potential plans:

ğŸ” Plan 1: Feature Analysis
â”œâ”€â”€ Generated: 3 minutes ago
â”œâ”€â”€ Type: Feature Plan
â”œâ”€â”€ Content: User authentication system
â”œâ”€â”€ Confidence: 87%
â””â”€â”€ Size: 1,924 words

ğŸ” Plan 2: Debug Analysis
â”œâ”€â”€ Generated: 8 minutes ago
â”œâ”€â”€ Type: Debug Plan
â”œâ”€â”€ Content: Login component issues
â”œâ”€â”€ Confidence: 81%
â””â”€â”€ Size: 1,456 words

ğŸ’¡ Selection Options:
â”œâ”€â”€ Save most recent: /save-this-plan --recent
â”œâ”€â”€ Save feature plan: /save-this-plan --type=feature
â”œâ”€â”€ Save debug plan: /save-this-plan --type=debug
â””â”€â”€ Save both: /save-this-plan --all

Which plan would you like to save? [1/2/all]: _
```

### Name Conflict Resolution
```
âš ï¸ NAME CONFLICT: feature-user-dashboard-20250715

ğŸ“‹ Existing Plan:
â”œâ”€â”€ Created: 2025-07-15 10:30:00
â”œâ”€â”€ Status: pending
â”œâ”€â”€ Size: 3,241 words
â””â”€â”€ Steps: 8 total

ğŸ“‹ New Plan:
â”œâ”€â”€ Generated: 2025-07-15 14:45:00
â”œâ”€â”€ Type: Feature Plan
â”œâ”€â”€ Size: 2,847 words
â””â”€â”€ Steps: 6 total

ğŸ’¡ Resolution Options:
â”œâ”€â”€ Overwrite existing: /save-this-plan --force
â”œâ”€â”€ Create version: /save-this-plan user-dashboard-v2
â”œâ”€â”€ Merge plans: /save-this-plan --merge
â””â”€â”€ Cancel save: /save-this-plan --cancel

Choose option [1-4]: _
```

## Integration with Workflow

### Seamless Plan Generation
```bash
# Typical workflow:
/new-feature real-time chat system
# ... plan is generated ...
/save-this-plan
# ... plan is automatically saved ...
/run-plan real-time-chat-system-20250715
```

### Batch Planning Session
```bash
# Planning session:
/new-feature user profiles
/save-this-plan profiles

/new-feature messaging system  
/save-this-plan messaging

/new-feature file sharing
/save-this-plan file-sharing

# Later execution:
/list-plans
/run-plan profiles
/run-plan messaging
/run-plan file-sharing
```

### Debug-and-Fix Workflow
```bash
# Debug workflow:
/ultra-debug payment processing
/save-this-plan payment-fix
/run-plan payment-fix

# Verify fix:
/understand payment processing
/save-this-plan payment-verification
```

## Success Indicators

### Successful Save
```
âœ… PLAN SAVED SUCCESSFULLY

ğŸ“‹ Save Summary:
â”œâ”€â”€ Plan type: Feature Plan
â”œâ”€â”€ Name: feature-user-dashboard-20250715
â”œâ”€â”€ Size: 2.8 KB
â”œâ”€â”€ Files created: 6
â””â”€â”€ Save time: 1.2 seconds

ğŸ“ Location: .claude/analysis/feature-user-dashboard-20250715/

ğŸš€ Quick Actions:
â”œâ”€â”€ Execute now: /run-plan user-dashboard-20250715
â”œâ”€â”€ View details: /plan-status user-dashboard-20250715
â”œâ”€â”€ List all plans: /list-plans
â””â”€â”€ Compare plans: /compare-plans user-dashboard-20250715 [other-plan]

ğŸ’¡ Tip: Use /run-plan user-dashboard-20250715 to execute this plan
```

### Auto-Save Confirmation
```
ğŸ”„ AUTO-SAVE ENABLED

ğŸ“‹ Future Behavior:
â”œâ”€â”€ All /new-feature plans will auto-save
â”œâ”€â”€ All /ultra-debug analyses will auto-save
â”œâ”€â”€ All /understand sessions will auto-save
â””â”€â”€ Manual save still available with /save-this-plan

âš™ï¸ Configuration:
â”œâ”€â”€ Auto-save location: .claude/analysis/
â”œâ”€â”€ Naming convention: [type]-[description]-[date]
â”œâ”€â”€ Overwrite policy: Create versions
â””â”€â”€ Retention policy: Keep all plans

ğŸ’¡ Disable auto-save: /save-this-plan --no-auto-save
```

This command provides the fastest way to save plans immediately after generation, supporting natural workflow where you generate a plan and immediately want to save it without extra typing.