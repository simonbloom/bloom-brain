# /save-this-plan - Save Last Generated Plan

## Purpose
Quickly save the most recently generated plan without needing to specify a name or details. This command automatically detects the last plan generated and saves it to the Claude analysis directory.

## Usage

### Basic Usage
```bash
/save-this-plan                 # Save last plan with auto-generated name
/save-this-plan [custom-name]   # Save last plan with custom name
```

### Advanced Options
```bash
/save-this-plan --force         # Overwrite existing plan with same name
/save-this-plan --preview       # Preview what would be saved
/save-this-plan --metadata      # Include additional metadata
/save-this-plan --archive       # Save and immediately archive
```

## Auto-Detection Logic

### Plan Detection
The command automatically detects the last generated plan by analyzing:
- Most recent command output
- Content patterns (implementation steps, analysis sections)
- Command history context
- Generated analysis structure

### Supported Plan Types
```
🔍 DETECTABLE PLAN TYPES

✅ Feature Plans:
├── Generated by: /new-feature [description]
├── Detection pattern: "Implementation Roadmap", "Phase 1", "Phase 2"
├── Auto-name format: feature-[description]-[date]
└── Save location: .claude/analysis/feature-[name]/

✅ Ultra-Debug Plans:
├── Generated by: /ultra-debug [target]
├── Detection pattern: "Ultra-Debug", "Root Cause Analysis", "Multi-MCP"
├── Auto-name format: ultra-debug-[target]-[session-id]
└── Save location: .claude/analysis/ultra-debug-[name]/

✅ Debug Plans:
├── Generated by: /understand [target]
├── Detection pattern: "Debug Analysis", "Solution Strategy"
├── Auto-name format: debug-[target]-[session-id]
└── Save location: .claude/analysis/debug-[name]/

✅ Architecture Plans:
├── Generated by: /architecture-map [area]
├── Detection pattern: "Architecture Analysis", "System Map"
├── Auto-name format: architecture-[area]-[date]
└── Save location: .claude/analysis/architecture-[name]/

✅ Impact Analysis:
├── Generated by: /impact-check [change]
├── Detection pattern: "Impact Assessment", "Risk Analysis"
├── Auto-name format: impact-[change]-[date]
└── Save location: .claude/analysis/impact-[name]/
```

## Execution Examples

### Save Feature Plan
```bash
# After running: /new-feature user notification system
/save-this-plan

# Output:
✅ PLAN SAVED: feature-user-notification-system-20250715

📁 Location: .claude/analysis/feature-user-notification-system-20250715/
📋 Files Created:
├── implementation-plan.md
├── research-findings.json
├── database-analysis.json
├── architecture-analysis.json
├── risk-assessment.json
└── execution-checklist.md

🚀 Next Steps: /run-plan user-notification-system-20250715
```

### Save Ultra-Debug Analysis
```bash
# After running: /ultra-debug spinner loading issue
/save-this-plan spinner-fix

# Output:
✅ PLAN SAVED: ultra-debug-spinner-fix

📁 Location: .claude/analysis/ultra-debug-spinner-fix/
📋 Files Created:
├── ultra-solutions-implementation-plan.md
├── root-cause-summary.md
├── mcp-tools-analysis.json
└── testing-strategy.md

🚀 Next Steps: /run-plan spinner-fix
```

### Save with Custom Name
```bash
# After running: /new-feature dashboard analytics
/save-this-plan analytics-dashboard-v2

# Output:
✅ PLAN SAVED: analytics-dashboard-v2

📁 Location: .claude/analysis/feature-analytics-dashboard-v2/
📋 Files Created:
├── implementation-plan.md
├── research-findings.json
├── database-analysis.json
└── execution-checklist.md

🚀 Next Steps: /run-plan analytics-dashboard-v2
```

## Content Analysis

### Plan Content Detection
```javascript
function detectPlanContent(lastOutput) {
  const patterns = {
    feature: {
      indicators: [
        'Implementation Roadmap',
        'Phase 1: Research',
        'Phase 2: Planning',
        'Feature Analysis',
        'Database Schema',
        'Component Architecture'
      ],
      confidence: 0.85
    },
    ultraDebug: {
      indicators: [
        'Ultra-Debug Phase',
        'Root Cause Analysis',
        'Multi-MCP Analysis',
        'Implementation Roadmap',
        'Ultra-Solutions',
        'MCP Tools Used'
      ],
      confidence: 0.90
    },
    debug: {
      indicators: [
        'Debug Analysis',
        'Solution Strategy',
        'Browser Agent',
        'Performance Agent',
        'Implementation Steps'
      ],
      confidence: 0.80
    }
  };
  
  return analyzePlanType(lastOutput, patterns);
}
```

### Auto-Name Generation
```javascript
function generatePlanName(type, content, customName) {
  if (customName) return customName;
  
  const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');
  const description = extractDescription(content);
  
  return `${type}-${description}-${timestamp}`;
}

function extractDescription(content) {
  // Extract meaningful description from plan content
  const titleMatch = content.match(/(?:Feature|Analysis|Debug).*?:\s*(.+)/i);
  if (titleMatch) {
    return titleMatch[1]
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, '')
      .replace(/\s+/g, '-')
      .slice(0, 30);
  }
  return 'unnamed-plan';
}
```

## Preview Mode

### Preview Before Saving
```bash
/save-this-plan --preview
```

```
🔍 PLAN PREVIEW: Last Generated Plan

📋 Detected Plan:
├── Type: Feature Plan
├── Confidence: 92%
├── Generated: 5 minutes ago
├── Content size: 2,847 words
└── Estimated save time: 3 seconds

📁 Save Details:
├── Auto-name: feature-user-dashboard-20250715
├── Location: .claude/analysis/feature-user-dashboard-20250715/
├── Files to create: 6
└── Storage required: 124 KB

📊 Plan Structure:
├── ✅ Executive Summary (247 words)
├── ✅ Implementation Roadmap (8 steps)
├── ✅ Database Analysis (5 tables)
├── ✅ Architecture Overview (12 components)
├── ✅ Risk Assessment (3 high, 5 medium risks)
└── ✅ Testing Strategy (unit, integration, e2e)

🚀 Save this plan? [Y/n]
```

## Error Handling

### No Plan Found
```
❌ NO PLAN DETECTED

📋 Analysis Results:
├── Last command: /list-plans
├── Output type: Management command
├── Plan content: None detected
└── Confidence: 0%

💡 Suggestions:
├── Generate a new plan: /new-feature [description]
├── Run debug analysis: /ultra-debug [target]
├── Check existing plans: /list-plans
└── View plan status: /plan-status [name]

🔍 Recent Commands:
├── /list-plans (2 minutes ago)
├── /run-plan user-auth (15 minutes ago)
├── /new-feature notifications (1 hour ago)
└── /save-this-plan (attempted)

💡 Try: /save-plan notifications (to save the notifications plan)
```

### Multiple Plans Detected
```
⚠️ MULTIPLE PLANS DETECTED

📋 Found 2 potential plans:

🔍 Plan 1: Feature Analysis
├── Generated: 3 minutes ago
├── Type: Feature Plan
├── Content: User authentication system
├── Confidence: 87%
└── Size: 1,924 words

🔍 Plan 2: Debug Analysis
├── Generated: 8 minutes ago
├── Type: Debug Plan
├── Content: Login component issues
├── Confidence: 81%
└── Size: 1,456 words

💡 Selection Options:
├── Save most recent: /save-this-plan --recent
├── Save feature plan: /save-this-plan --type=feature
├── Save debug plan: /save-this-plan --type=debug
└── Save both: /save-this-plan --all

Which plan would you like to save? [1/2/all]: _
```

### Name Conflict Resolution
```
⚠️ NAME CONFLICT: feature-user-dashboard-20250715

📋 Existing Plan:
├── Created: 2025-07-15 10:30:00
├── Status: pending
├── Size: 3,241 words
└── Steps: 8 total

📋 New Plan:
├── Generated: 2025-07-15 14:45:00
├── Type: Feature Plan
├── Size: 2,847 words
└── Steps: 6 total

💡 Resolution Options:
├── Overwrite existing: /save-this-plan --force
├── Create version: /save-this-plan user-dashboard-v2
├── Merge plans: /save-this-plan --merge
└── Cancel save: /save-this-plan --cancel

Choose option [1-4]: _
```

## Integration with Workflow

### Seamless Plan Generation
```bash
# Typical workflow:
/new-feature real-time chat system
# ... plan is generated ...
/save-this-plan
# ... plan is automatically saved ...
/run-plan real-time-chat-system-20250715
```

### Batch Planning Session
```bash
# Planning session:
/new-feature user profiles
/save-this-plan profiles

/new-feature messaging system  
/save-this-plan messaging

/new-feature file sharing
/save-this-plan file-sharing

# Later execution:
/list-plans
/run-plan profiles
/run-plan messaging
/run-plan file-sharing
```

### Debug-and-Fix Workflow
```bash
# Debug workflow:
/ultra-debug payment processing
/save-this-plan payment-fix
/run-plan payment-fix

# Verify fix:
/understand payment processing
/save-this-plan payment-verification
```

## Success Indicators

### Successful Save
```
✅ PLAN SAVED SUCCESSFULLY

📋 Save Summary:
├── Plan type: Feature Plan
├── Name: feature-user-dashboard-20250715
├── Size: 2.8 KB
├── Files created: 6
└── Save time: 1.2 seconds

📁 Location: .claude/analysis/feature-user-dashboard-20250715/

🚀 Quick Actions:
├── Execute now: /run-plan user-dashboard-20250715
├── View details: /plan-status user-dashboard-20250715
├── List all plans: /list-plans
└── Compare plans: /compare-plans user-dashboard-20250715 [other-plan]

💡 Tip: Use /run-plan user-dashboard-20250715 to execute this plan
```

### Auto-Save Confirmation
```
🔄 AUTO-SAVE ENABLED

📋 Future Behavior:
├── All /new-feature plans will auto-save
├── All /ultra-debug analyses will auto-save
├── All /understand sessions will auto-save
└── Manual save still available with /save-this-plan

⚙️ Configuration:
├── Auto-save location: .claude/analysis/
├── Naming convention: [type]-[description]-[date]
├── Overwrite policy: Create versions
└── Retention policy: Keep all plans

💡 Disable auto-save: /save-this-plan --no-auto-save
```

This command provides the fastest way to save plans immediately after generation, supporting natural workflow where you generate a plan and immediately want to save it without extra typing.